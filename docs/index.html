<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to data visualisation with ggplot2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ben Matthews and Eilidh Jack" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">







name: title
class: center, middle, inverse

# Introduction to data visualisation with `ggplot2`

Ben Matthews and Eilidh Jack

29/06/2020

![](https://www.understanding-inequalities.ac.uk/sites/all/themes/theme935/logo.png)&lt;!-- --&gt;


---


# Welcome!

- What we're going to cover

- Course outline: https://github.com/benmatthewsed/ui-data-visualization-course/blob/master/course_outline.md

- Who we are

- Code of conduct

---

name: outline

# Course outline

- [What is `ggplot2`?](https://benmatthewsed.github.io/ui-data-visualization-course/#what-is-ggplot)
- [Concepts in the grammar of graphics](https://benmatthewsed.github.io/ui-data-visualization-course/#concepts-grammar-graphics)
- [Types of geom](https://benmatthewsed.github.io/ui-data-visualization-course/#geom-types)
- [Principles of data visualization](https://benmatthewsed.github.io/ui-data-visualization-course/#principles-data-viz)
- [gg-gotchas](https://benmatthewsed.github.io/ui-data-visualization-course/#gggotchas)
- [Mapping with `ggplot2`](https://benmatthewsed.github.io/ui-data-visualization-course/#ggplot-maps)
- [`ggplot2` colour scales](https://benmatthewsed.github.io/ui-data-visualization-course/#ggplot-colour-scales)
- [Annotations](https://benmatthewsed.github.io/ui-data-visualization-course/#ggplot-annotations)
- [publication-ready plots](https://benmatthewsed.github.io/ui-data-visualization-course/#publication-plots)

---

# House rules

- Ask questions whenever üëç
- You can do this through the Blackboard chat facility {demo this now}
- We've structured the sessions with regular breaks, but if you need to leave just leave!
- Materials will live online somewhere so you can catch up later on
- "You're not working from home, you're at home during a crisis trying to work"



---

# Who you are

- Why this course?
- What do you want to achieve?


---

name: what-is-ggplot
class: center, middle, inverse

# Wait, what even `*`is`*` `ggplot2`?

---


# What is `ggplot2`?

- It's an `R` package that draws graphs, developed by [Hadley Wickham](http://hadley.nz/)

- From the [tidyverse website](https://ggplot2.tidyverse.org/): "`ggplot2` is a system for __declaratively__ creating graphics, based on The Grammar of Graphics. You provide the data, tell `ggplot2` how to map variables to aesthetics, what [visual marks to use to represent data points], and it takes care of the details." 

- ... and what's the Grammar of Graphics? Our `ggplot2` [cheat sheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf) says this is "the idea that you can __build every graph from the same components__: a data set, a coordinate system, and `geom`s‚Äîvisual marks that represent data points." 

---
class: center, middle, inverse

# Great, so why plot with `ggplot2`?

---
class: center, middle, inverse

# 1. Aids perception üí°

---

## Perception

- Learning `ggplot2` will help you __understand how data visualization works__, how to figure out what you want your plots to look like and describe this to the computer.
- This is because it's __declarative__. You describe to the computer exactly what you want the plot to look like and it draws it for you (rather than, say, picking a type of plot from a menu). You can read a whole [blog post about](http://varianceexplained.org/r/why-I-use-ggplot2/) why this is a good thing!
- So by using `ggplot2` you learn how to make __better__ graphs, not just how to make graphs.

---
class: center, middle, inverse

# 2. It's powerful  üí™
---

## It's Powerful
- Because it's declarative it's also __flexible__
- You can make pretty pretty much __any type__ of (static) graph you want! (No fancy interactive web graphics though, sorry)
- This is very powerful! You can make __publication__ (or Twitter) quality graphs

---
class: center, middle, inverse

# 3. It's popular üòé

---

## It's popular

- There is a large community of users who use `ggplot2` to communicate with very different audiences
- `ggplot2` is used by data journalists at major outlets [BBC](https://bbc.github.io/rcookbook/) and [Financial Times](https://johnburnmurdoch.github.io/slides/r-ggplot/#/)
- As well as technical users who have [extended](https://exts.ggplot2.tidyverse.org/) `ggplot2`'s core functions for specific use cases
- You can use the same tool to visualize data effectively for academic audiences as well as the general public (also just for ourselves), and because users often __post their code online__ you learn from these many users!

---
class: center, middle, inverse

# One more thing before we begin...
---

## `ggplot2` is powerful and fallible

- `ggplot2` is a world unto itself (technically, it's a [domain specific language](http://adv-r.had.co.nz/dsl.html))
- It's also a world with [quirks](https://www.youtube.com/watch?v=vYwXMnC03I4)
- .. so when learning how to use `ggplot2`, mistakes are gonna happen - even for existing `R` users - and that's __fine!__ üëç
- Every error is a learning opportunity - we're all building up better mental models of how `ggplot2` works, and finding things that don't work as expected (or at all!) help us do this too üéâ
- We'll talk about common 'gotchas' later on

---
name: concepts-grammar-graphics
class: center, middle, inverse

# Concepts in the grammar of graphics

---


class: center, middle, inverse


# __Dataset__ + 
# __mapping__ variables in the dataset to `aes`thetics + 
# __Layers__ of `geom`s (symbols to represent data) = 
# __Plot__


---
class: center, middle, inverse


# __Dataset__ + 
# Mapping variables in the dataset to `aes`thetics + 
# Layers of `geom`s (symbols to represent data) = 
# Plot


{demo call here}



---

# Data

- Erm, the dataset you're plotting!
- `ggplot2` expects your dataset to be [tidy](https://r4ds.had.co.nz/tidy-data.html):
    1. Each variable must have its own column.
    2. Each observation must have its own row.
    3. Each value must have its own cell.
- From _R for Data Science_:
![](https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png)&lt;!-- --&gt;
- Don't worry about this during the course - the datasets we're using have been tidied already


---

class: center, middle, inverse


# Dataset + 
# __Mapping__ variables in the dataset to `aes`thetics + 
# Layers of `geom`s (symbols to represent data) = 
# Plot


---


# Mapping variables to `aes()`thetics

- __Which variables__ in your dataset you want to represent in the plot and __how__
- Most of the time you'll want at least `x` and `y` (these are __position__ `aes`thetics)
- Includes __other visual encodings__ like: colour/fill, shape, linetype, alpha (transparency), size...
- __Key point__ - if you want `ggplot` know about something __inside your dataset you have to reference it within__ `aes`!

- Insert examples here of same dataset with different mappings

{demo call here}

---

# Mapping helps thinking

- This is part of what makes `ggplot` so helpful for thinking about data visualization - you get to choose how you want
to map variables to aesthetics and how to represent them in layers in a __declarative__ way.
- Decide __what to emphasise__ in your plot based on what you're interested in; the same data mapped to different `aes()`thetics can have different emphasis
- (Obviously you can do this with other plotting programs too, but I think it's more __explicit__ in `ggplot`)


---

class: center, middle, inverse


# Dataset + 
# Mapping variables in the dataset to `aes`thetics + 
# __Layers__ of `geom`s (symbols to represent data) = 
# Plot


---

# `geom`etric symbols to represent data

- __What__ symbols you want `ggplot` to draw to represent the data; lines, points, errorbars, ribbons, contours...
- You add these to the plot in __layers__
- You can have exactly the same mapping of variables to `aes`thetics, but different `geom`s

{demo call here}

---

# Layers and `geom`s

- `ggplot2` builds plots out of __layers__
- This makes it suuuuuuper flexible - you can just __stack layers on top of each other__!
- `geom`s only add __one layer at a time__
- __Add__ layers together_ with `+` __operator__
- __Order matters!__

{demo call here}

---

# `geom`s and `aes`thetics

- __Every__ `geom` __needs__ a dataset and a mapping of variables to `aes`thetics
- Layers (silently!) __inherit__ data and `aes` mappings that you set __for the whole plot__...
- ... but you can set data and aesthetics for whole plot and for each layer __separately__, so you can override this default behaviour
- This is often very helpful but also a big source of pain - __THERE BE DRAGONS__ üêâ
- Again, if you want a layer to reference something in your dataset you need to tell it with `aes`

{demo call here}

---

# Set `geom` parameters with `aes` or with a fixed value?

- You use `geom`s to visually represent values of the __variables in your dataset__
- But sometimes you also want to change how a `geom` looks to a __fixed value__ (i.e. one that __doesn't__ come from a variable) in your dataset - like making all the points in a scatterplot red
- If it's within the call to `aes`, `ggplot2` will look for it in your dataset
- If it's outside the call to `aes`, `ggplot2` will apply the value you supply directly
- size = 2, colour = "red"
- `aes(size = 2, colour = "red")`
- For technical reasons we won't go into now __quotation marks matter__ here (if you want you can read all about why [here](https://adv-r.hadley.nz/metaprogramming.html))
- This was a common source of errors for me when learning `ggplot2` (and still is!) and my own mental model of when and why to use quote marks is pretty crude even now. So it's natural that this feels weird or arbitrary right now üëç


{demo call here}

---

class: center, middle, inverse

# __Dataset__ + 
# __Mapping__ variables in the dataset to `aes`thetics + 
# __Layers__ of `geom`s (symbols to represent data) = 
# __Plot__


---

# Things to look out for

- If you want `ggplot` to know about something in your dataset, use `aes()`
- Order matters in the `ggplot` call

---
name: geom-types
class: center, middle, inverse
# Types of geom

---

class: center, middle, inverse

# Three types of `geom` layer

---

# Three types of `geom`

- I like to think of `geom`s as being one of three types:
- `geom`s that plot each datum for you
- `geom`s that plot summaries of your dataset for you
- `geom`s that plot things that aren't in your dataset (like reference lines and such); often metadata
- (The official `ggplot` book uses a [slightly different classification system](https://ggplot2-book.org/toolbox.html) for `geom`s)

---

# Plot each datum please

- Make a mark on the plot for __each row__ in the dataset

    - `geom_point`
    - `geom_line`
    - `geom_bar` (sort of)
    - `geom_errorbar` (sort of)
    - `geom_tile`
    - `geom_sf()` (we'll come back to this in the next session)
    - `geom_text()` (sometimes)


---

# Plot a summary of my data please

- Plot something that summarises all/groups of the data in my datset

- Univariate/distributions:
    - `geom_histogram`
    - `geom_density`
    - `geom_violin`
- Bivariate:
    - `geom_smooth`
    - `geom_contour`
    
    
---

# Plot something else on my graph

- Reference lines
    - `geom_vline`
    - `geom_hline`
    - `geom_abline`

- Annotations
    - `geom_text()` (sometimes)

---

# Live coding


---
class: center, middle, inverse

# Ask yourself - do you want to plot your data? A summary of your data? 
# ...Or both?


---
name: principles-data-viz
# Principles of data visualization

---


# Principles of data viz

- How we read graphs
- Chart design guidelines
- An example

---

# How we read graphs

# Cleveland's elementary perceptual tasks

- Position along a common scales
- Position along identical, nonaligned scales
- Length
- Angle ‚Äì Slope
- Area
- Volume
- Colour hue ‚Äì Colour saturation ‚Äì Density	

{add figure here}

---


#  Vanderplas

- The whole [paper](https://www.annualreviews.org/doi/full/10.1146/annurev-statistics-031219-041252) is interesting!

- 3.1.‚ÄÇCognitive Principles
- 3.1.1.‚ÄÇProximity - "objects or shapes that are close to one another appear to form groups... place items to compare close together, and less important comparisons further apart"
- 3.1.2.‚ÄÇSimilarity - "we group things that have similar appearances and exclude objects with different appearances"; "coloring points or bars according to a categorical variable or by using points of different shapes to represent different categories."
- 3.1.3.‚ÄÇCommon region. "elements contained within a common region belong together"
- 3.1.4.‚ÄÇCommon fate.
     - Strong negative association is not easily detected from overlaid line plots, but it is easily seen in a scatter plot (Tomasetti 2015).

---

# Match perceptual and data topography (Wickham 2012)
- If you‚Äôre using a graphical element to show relative size of quantities, make larger size = larger quantity!
- For example, which represents larger value?


     
---

#  Vanderplas
##  3.2.‚ÄÇChart Design


- Dual coding: You can encode the same variables to multiple aesthetic parameters (easily in `ggplot2`) to aid comprehension
- This can also aid accessibility by reducing reliance on e.g. colour to distinguish variables
- Use colour scales designed to have good perceptual properties for different kinds of colour-blindness (`ggplot2` defaults aren't so good for this)

---

# Cleveland's principles of graph construction

1. Clear vision
    - Make the data stand out and avoid superfluity
    - Use a reference line if there is an important value which must be seen across the whole graph
2. Clear understanding
    - Put major conclusions in graphical form
    - Clearly explain error bars
3. Scales
    - Choose axes ranges to include or nearly include the range of data
    - Don‚Äôt insist that zero is included in scales showing magnitude
4. General strategy
    - Graphing should be iterative and experimental
    - Graph data two or more times if it is needed

---

# Plot the raw data and the summary

---

# An example

- My bad graph from my thesis

![](https://github.com/benmatthewsed/ui-data-visualization-course/blob/master/figures/thesis_figure.png)&lt;!-- --&gt;

---
name: gggotchas
# gg-gotchas

---


# Common problems with `ggplot2`

1. Two joined lines (multiple groups) ["sawtooth"](https://ggplot2-book.org/collective-geoms.html)

    - From _R for Data Science_:
    
    ![](https://ggplot2-book.org/collective-geoms_files/figure-html/oxboys-line-bad-1.png)&lt;!-- --&gt;


---
2. Groups == only one observation (categorical x-variable)

    - Data types matter

3. Stat count y aesthetic

    - The geom wants to compute a summary but you've already provided summarised data

4. `+` on newline

    - For [technical reasons I don't understand](https://community.rstudio.com/t/why-put-and-at-the-end-of-lines/1831) this isn't valid R code. So you can't do it!

5. Call inside/outside `aes()`
    - See our discussion on concepts in the grammar of graphics 
    
6. Geom density with small n
    - Plot the raw data and the summary together

7. Variable types
    - Colouring by a factor variable or a continuous one

---


# Recap


---

# What is `ggplot2`?

- It's an `R` package that draws graphs, developed by [Hadley Wickham](http://hadley.nz/)

- From the [tidyverse website](https://ggplot2.tidyverse.org/): "`ggplot2` is a system for __declaratively__ creating graphics, based on The Grammar of Graphics. You provide the data, tell `ggplot2` how to map variables to aesthetics, what [visual marks to use to represent data points], and it takes care of the details." 

- ... and what's the Grammar of Graphics? Our `ggplot2` [cheat sheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf) says this is "the idea that you can __build every graph from the same components__: a data set, a coordinate system, and `geom`s‚Äîvisual marks that represent data points." 

---

class: center, middle, inverse

- Aids perception
- Is powerful
- Is popular


---

class: center, middle, inverse


# Dataset + 
# _mapping_ variables in the dataset to `aes`thetic + 
# Layers of `geom`s (symbols to represent data) = 
# Plot


---

# Three types of `geom`

- `geom`s that plot each datum for you
- `geom`s that plot summaries of your dataset for you
- `geom`s that plot things that aren't in your dataset (like reference lines and such)


---

- Design your data viz with your audience in mind
- Use best practice: design graphs that are easy to understand

---

- Errors are going to happen and that's fine!


---

# In the next session

- The fun stuff!
- Maps
- Beautifying your ggplots
- Answering any questions you have between now and then
- Please feel free to bring your own data!






---

# Optional homework

- Try out this week's [#TidyTuesday](https://github.com/rfordatascience/tidytuesday) challenge



---
name: ggplot-maps
# Maps in `ggplot2`

---


1. Maps are great (we take this as axiomatic!)
4. In `R`, maps are "different, and weird" -- [Danielle Navarro](https://djnavarro.net/post/maps/)
3. Maps can be misleading
5. Use with caution!

---


# What are we mapping ?

- If you're on this course we assume that you are:
    - Analysing data about people
    - These people are on Earth, and may well be in the UK
- So you'll [probably have __vector__ data](https://geocompr.robinlovelace.net/spatial-class.html#vector-data) - i.e. __points in space__ (and not raster data, which breaks up space into evenly sized grids, like in ecology or something)
- And mostly you'll be plotting __areal__ data - which relates to some shape bounded in space (like a Local Authority or neighbourhood), and data about these areal entities will likely be __aggregates__ describing the population within that area - e.g. votes, or recorded crimes, or percent unemployed... etc.

---

# Okay, but what "space"?

- Turns out that this is a really complicated question!
- We turn representations of the 3d surface of the Earth into a 2d map using a [coordinate reference system (CRS)](https://geocompr.robinlovelace.net/spatial-class.html#crs-intro)
- This won't come up here ü§û because we've set the CRS for you in our example dataset, but `ggplot2` needs to know the CRS of your data in order to draw the plot
- If your map looks funny it may well be that you have the wrong CRS


---

# Maps in `R` are "different and weird"

---

# Maps in `R`: simple features

- Working with spatial data in `R` is a whole sub-field in itself (see [here](https://geocompr.robinlovelace.net/ from a GIS/geoscience perspective) for a GIS introduction, and [here](https://socviz.co/maps.html#maps) for a social sciences introduction)
- We use the [`{sf}` package](https://r-spatial.github.io/sf/articles/sf1.html)
- The geographical information in your dataset gets a special `geometry` column with our geographical information in
- This is works nicely with tidy data and `ggplot2`
- `ggplot2` figures out how to draw the map based on the CRS, so this changes some of how we would usually ask `ggplot2` to draw the map


---

# Maps can be misleading: 


- __Chloropleth__ maps - coloured in maps - are a good idea when you have high spatial resolution, but can be [misleading when you have low spatial resolution](https://serialmentor.com/dataviz/geospatial-data.html#choropleth-mapping)
- This is because these maps can be [dominated by geographic units with large areas](https://serialmentor.com/dataviz/geospatial-data.html#choropleth-mapping) if the areas of your geographies are very different (this is very much the case for Scottish Local Authorities!)
- ... and such areas often have low populations
- This is not so bad when you're mapping [densities](https://serialmentor.com/dataviz/geospatial-data.html#choropleth-mapping) - where the denominator is the area of the spatial unit

---

# Maps can be misleading: parameter estimates

"[P]lotting observed rates can have serious drawbacks when sample sizes vary by area, since very high (and low) observed rates are found disproportionately in poorly-sampled areas. Unfortunately, adjusting the observed rates to account for the effects of
small-sample noise can introduce an opposite effect, in which the highest adjusted rates tend to be found disproportionately in well-sampled areas. In either case, the maps can be diffcult to interpret because the display of spatial variation in the underlying parameters of interest is confounded with spatial variation in sample sizes" [Gelman and Rice](http://www.stat.columbia.edu/~gelman/research/published/allmaps.pdf) üò±


---

# Maps can be misleading: Who is at risk?

- Mapping counts of things can be confounded by areas with the [highest population](https://socviz.co/maps.html#maps)
- Mapping rates are affected by the sample size issues on the previous slide...
- ... and also the [Modifiable Areal Unit Problem](https://en.wikipedia.org/wiki/Modifiable_areal_unit_problem)


---

# Maps can be misleading: What shapes to draw?

- We're going to focus on the simple case: __polygons__ that represent Local Authority boundaries
- But you might want to change the shapes to adjust for e.g. population size as in a __cartogram__
- Or maybe you want to arrange facets (as in facet_wrap) in the shape of your spatial data as in a [__geofacet__](https://hafen.github.io/geofacet/) (see also Kieran Healy's thoughts on ['Is your data really spatial?'](https://socviz.co/maps.html#is-your-data-really-spatial))

---

# Maps can be misleading
# Use with caution!


---
name: ggplot-colour-scales
# Colour scales

---

# `ggplot2` default colour scale

- continous
- categorical


![ggplot2-default-colour](https://ggplot2-book.org/diagrams/colour-wheel.png)

- You have to make sure `ggplot` is treating your data in the right way (continuous if you want a continuous scale, discrete if you want a discrete scale)

---

# Good defaults

- scale viridis
- scaleOkabeIto ({colorblindr})


# Other options
- scale_colour_grey
- scale_color_brewer()


---

# Advanced - making your own

- If only one colour you want you can set with `colour = "#123456"` using the colour [hex-code](https://www.color-hex.com/)


- For discrete values
- `scale_colour_manual()`

---

name: ggplot-annotations

# Annotations and labels

---


---

# On the plots

1. Reference lines


---


2. geom_text
4. Going further - [arrows](https://bbc.github.io/rcookbook/#add_annotations)
3. titles



---

# `labs()`

- `title`, `subtitle` and `captions`
- Can also rename your axes here
- As well as any other `aes`thetic mappings like colour, fill, shape, size...

---

name: publication-plots

# Publication-ready plots

---


---

# Themes

- `theme()` is a bit üò±


- changing the theme

- scales

- If you want to change the theme with `theme_{whatever}` AND adjust
properties settings with `theme()` the call to `theme_{whatever}` __must come first!__


---
# `theme()`
- moving guides
- `legend.position="bottom"`

- rotating axis labels
- `axis.text.x = element_text(angle = 45, hjust = 1)`

---

# Scales

- See https://scales.r-lib.org/


---

# Saving the plot

- Throughout the session we've just let plots print out in the plots pane
- Not so convenient if you want to show someone else your work!

- `ggsave()`
- `filename = `
- `plot = `
- `type = "cairo-png"`
- `height =`
- `width =`
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
